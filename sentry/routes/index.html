<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Sentry REST API documentation"><meta name="keywords" content="rust, rustlang, rust-lang, routes"><title>sentry::routes - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../sentry/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../sentry/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module routes</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#modules">Modules</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../sentry/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">sentry</a>::<wbr><a class="mod" href="#">routes</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/sentry/routes.rs.html#1-538">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Sentry REST API documentation</p>
<p>This module includes the documentation for all routes of the <code>Sentry</code>
REST API and the corresponding requests, responses and parameters.</p>
<p>All routes are listed below. Here is an overview and links to all of them:</p>
<ul>
<li><a href="#channel">Channel</a> routes
<ul>
<li><a href="#get-v5channellist">GET <code>/v5/channel/list</code></a></li>
<li><a href="#get-v5channelidaccounting">GET <code>/v5/channel/:id/accounting</code></a></li>
<li><a href="#get-v5channelidspenderaddr-auth-required">GET <code>/v5/channel/:id/spender/:addr</code></a> (auth required)</li>
<li><a href="#post-v5channelidspenderaddr-auth-required">POST <code>/v5/channel/:id/spender/:addr</code></a> (auth required)</li>
<li><a href="#get-v5channelidspenderall-auth-required">GET <code>/v5/channel/:id/spender/all</code></a> (auth required)</li>
<li><a href="#get-v5channelidvalidator-messages">GET <code>/v5/channel/:id/validator-messages</code></a></li>
<li><a href="#get-v5channelidvalidator-messages">GET <code>/v5/channel/:id/validator-messages/:addr</code></a></li>
<li><a href="#get-v5channelidvalidator-messages">GET <code>/v5/channel/:id/validator-messages/:addr/:validator_messages</code></a></li>
<li><a href="#post-v5channelidvalidator-messages-auth-required">POST <code>/v5/channel/:id/validator-messages</code></a> (auth required)</li>
<li><a href="#get-v5channelidlast-approved">GET <code>/v5/channel/:id/last-approved</code></a></li>
<li><a href="#post-v5channelidpay-auth-required">POST <code>/v5/channel/:id/pay</code></a> (auth required)</li>
<li><a href="#get-v5channelidget-leaf">GET <code>/v5/channel/:id/get-leaf</code></a></li>
<li><a href="#post-v5channeldummy-deposit-auth-required">POST <code>/v5/channel/dummy-deposit</code></a> (auth required) available only with Dummy adapter</li>
</ul>
</li>
<li><a href="#campaign">Campaign</a> routes
<ul>
<li><a href="#get-v5campaignlist">GET <code>/v5/campaign/list</code></a></li>
<li><a href="#post-v5campaign-auth-required">POST <code>/v5/campaign</code></a> (auth required)</li>
<li><a href="#post-v5campaignid-auth-required">POST <code>/v5/campaign/:id</code></a> (auth required)</li>
<li><a href="#post-v5campaignidevents">POST <code>/v5/campaign/:id/events</code></a> (auth required)</li>
<li><a href="#post-v5campaignidclose-auth-required">POST <code>/v5/campaign/:id/close</code></a> (auth required)</li>
</ul>
</li>
<li><a href="#analytics">Analytics</a> routes
<ul>
<li><a href="#get-v5analytics">GET <code>/v5/analytics</code></a></li>
<li><a href="#get-v5analyticsfor-publisher-auth-required">GET <code>/v5/analytics/for-publisher</code></a> (auth required)</li>
<li><a href="#get-v5analyticsfor-advertiser-auth-required">GET <code>/v5/analytics/for-advertiser</code></a> (auth required)</li>
<li><a href="#get-v5analyticsfor-admin-auth-required">GET <code>/v5/analytics/for-admin</code></a> (auth required)</li>
</ul>
</li>
<li><a href="#get-cfg">GET <code>/cfg</code></a></li>
</ul>
<h3 id="channel"><a href="#channel">Channel</a></h3>
<p>All routes are implemented under the module <a href="channel/index.html" title="channel">channel</a>.</p>
<h4 id="route-parameters"><a href="#route-parameters">Route parameters</a></h4>
<p>Paths which include these parameters are validated as follows:</p>
<ul>
<li><code>:id</code> - <a href="../../primitives/channel/struct.ChannelId.html"><code>ChannelId</code></a></li>
<li><code>:addr</code> - a valid <a href="../../primitives/address/struct.Address.html"><code>Address</code></a> or <a href="../../primitives/validator/struct.ValidatorId.html"><code>ValidatorId</code></a>.</li>
</ul>
<h4 id="routes"><a href="#routes">Routes</a></h4><h5 id="get-v5channellist"><a href="#get-v5channellist">GET <code>/v5/channel/list</code></a></h5>
<p>The route is handled by <a href="channel/fn.channel_list.html" title="channel::channel_list()"><code>channel::channel_list()</code></a>.</p>
<p>Request query parameters: <a href="../../primitives/sentry/channel_list/struct.ChannelListQuery.html"><code>ChannelListQuery</code></a></p>
<p>Response: <a href="../../primitives/sentry/channel_list/struct.ChannelListResponse.html"><code>ChannelListResponse</code></a></p>
<h6 id="examples"><a href="#examples">Examples</a></h6>
<p>Query:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{
    sentry::channel_list::ChannelListQuery,
    test_util::{IDS, LEADER},
    ChainId,
};

<span class="kw">fn </span>main() {
    <span class="comment">// An empty query
    </span>{
        <span class="kw">let </span>empty = <span class="string">&quot;&quot;</span>;
        <span class="kw">let </span>empty_expected = ChannelListQuery {
            page: <span class="number">0</span>,
            validator: <span class="prelude-val">None</span>,
            chains: <span class="macro">vec!</span>[],
        };

        <span class="macro">assert_eq!</span>(empty_expected, serde_qs::from_str(empty).unwrap());
    }

    <span class="comment">// Query with `page`
    </span>{
        <span class="kw">let </span>only_page = <span class="string">&quot;page=14&quot;</span>;
        <span class="kw">let </span>only_page_expected = ChannelListQuery {
            page: <span class="number">14</span>,
            validator: <span class="prelude-val">None</span>,
            chains: <span class="macro">vec!</span>[],
        };

        <span class="macro">assert_eq!</span>(only_page_expected, serde_qs::from_str(only_page).unwrap());
    }

    <span class="comment">// Query with `validator`
    </span>{
        <span class="kw">let </span>only_validator = <span class="string">&quot;validator=0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>;
        <span class="kw">let </span>only_validator_expected = ChannelListQuery {
            page: <span class="number">0</span>,
            validator: <span class="prelude-val">Some</span>(IDS[<span class="kw-2">&amp;</span>LEADER]),
            chains: <span class="macro">vec!</span>[],
        };

        <span class="macro">assert_eq!</span>(
            only_validator_expected,
            serde_qs::from_str(only_validator).unwrap()
        );
    }

    <span class="comment">// Query with `chains`
    </span>{
        <span class="kw">let </span>chains_query = <span class="string">&quot;chains[]=1&amp;chains[]=1337&quot;</span>;
        <span class="kw">let </span>chains_expected = ChannelListQuery {
            page: <span class="number">0</span>,
            validator: <span class="prelude-val">None</span>,
            chains: <span class="macro">vec!</span>[ChainId::new(<span class="number">1</span>), ChainId::new(<span class="number">1337</span>)],
        };

        <span class="macro">assert_eq!</span>(chains_expected, serde_qs::from_str(chains_query).unwrap());
    }

    <span class="comment">// Query with all parameters
    </span>{
        <span class="kw">let </span>all_query =
            <span class="string">&quot;page=14&amp;validator=0x80690751969B234697e9059e04ed72195c3507fa&amp;chains[]=1&amp;chains[]=1337&quot;</span>;
        <span class="kw">let </span>all_expected = ChannelListQuery {
            page: <span class="number">14</span>,
            validator: <span class="prelude-val">Some</span>(IDS[<span class="kw-2">&amp;</span>LEADER]),
            chains: <span class="macro">vec!</span>[ChainId::new(<span class="number">1</span>), ChainId::new(<span class="number">1337</span>)],
        };

        <span class="macro">assert_eq!</span>(all_expected, serde_qs::from_str(all_query).unwrap());
    }
}</code></pre></div>
<h5 id="get-v5channelidaccounting"><a href="#get-v5channelidaccounting">GET <code>/v5/channel/:id/accounting</code></a></h5>
<p>Gets all of the accounting entries for a channel from the database and checks the balances.</p>
<p>The route is handled by <a href="channel/fn.get_accounting_for_channel.html" title="channel::get_accounting_for_channel()"><code>channel::get_accounting_for_channel()</code></a>.</p>
<p>Response: <a href="../../primitives/sentry/struct.AccountingResponse.html"><code>AccountingResponse</code></a></p>
<h6 id="examples-1"><a href="#examples-1">Examples</a></h6>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{balances::CheckedState, sentry::AccountingResponse};
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="comment">// Empty balances
    </span>{
        <span class="kw">let </span>json = <span class="macro">json!</span>({
          <span class="string">&quot;earners&quot;</span>: {},
          <span class="string">&quot;spenders&quot;</span>: {},
        });
        <span class="macro">assert!</span>(from_value::&lt;AccountingResponse::&lt;CheckedState&gt;&gt;(json).is_ok());
    }

    <span class="comment">// Non-empty balances
    </span>{
        <span class="comment">// earners sum and spenders sum should always match since balances are CheckedState
        </span><span class="kw">let </span>json = <span class="macro">json!</span>({
            <span class="string">&quot;earners&quot;</span>: {
                <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>: <span class="string">&quot;10000000000&quot;</span>,
                <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>: <span class="string">&quot;20000000000&quot;</span>,
                <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>: <span class="string">&quot;30000000000&quot;</span>,
            },
            <span class="string">&quot;spenders&quot;</span>: {
                <span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>: <span class="string">&quot;60000000000&quot;</span>,
            },
        });
        <span class="macro">assert!</span>(from_value::&lt;AccountingResponse::&lt;CheckedState&gt;&gt;(json).is_ok());
    }
}</code></pre></div>
<h5 id="get-v5channelidspenderaddr-auth-required"><a href="#get-v5channelidspenderaddr-auth-required">GET <code>/v5/channel/:id/spender/:addr</code> (auth required)</a></h5>
<p>Gets the spender limits for a spender on a <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a>. It does so by fetching the
latest Spendable entry from the database (or creating one if it doesn’t exist yet) from which
the total deposited amount is retrieved, and the latest NewState from which the total spent
amount is retrieved.</p>
<p>The route is handled by <a href="channel/fn.get_spender_limits.html" title="channel::get_spender_limits()"><code>channel::get_spender_limits()</code></a>.</p>
<p>Response: <a href="../../primitives/sentry/struct.SpenderResponse.html"><code>SpenderResponse</code></a></p>
<h6 id="examples-2"><a href="#examples-2">Examples</a></h6>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::SpenderResponse;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="kw">let </span>json = <span class="macro">json!</span>({
        <span class="string">&quot;spender&quot;</span>: {
            <span class="string">&quot;totalDeposited&quot;</span>: <span class="string">&quot;10000000000&quot;</span>,
            <span class="string">&quot;totalSpent&quot;</span>: <span class="string">&quot;100000000&quot;</span>,
        },
    });
    <span class="macro">assert!</span>(from_value::&lt;SpenderResponse&gt;(json).is_ok());
}</code></pre></div>
<h5 id="post-v5channelidspenderaddr-auth-required"><a href="#post-v5channelidspenderaddr-auth-required">POST <code>/v5/channel/:id/spender/:addr</code> (auth required)</a></h5>
<p>This route forces the addition of a spender <a href="../db/accounting/struct.Accounting.html"><code>Accounting</code></a>
(if one does not exist) to the given <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a> with <code>spent = 0</code>.
This will also ensure that the spender is added to the <a href="../../primitives/validator/messages/struct.NewState.html"><code>NewState</code></a> as well.</p>
<p>The route is handled by <a href="channel/fn.add_spender_leaf.html" title="channel::add_spender_leaf()"><code>channel::add_spender_leaf()</code></a>.</p>
<p>Response: <a href="../../primitives/sentry/struct.SuccessResponse.html"><code>SuccessResponse</code></a></p>
<h5 id="get-v5channelidspenderall-auth-required"><a href="#get-v5channelidspenderall-auth-required">GET <code>/v5/channel/:id/spender/all</code> (auth required)</a></h5>
<p>This routes gets total_deposited and total_spent for every spender on a <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a></p>
<p>The route is handled by <a href="channel/fn.get_all_spender_limits.html" title="channel::get_all_spender_limits()"><code>channel::get_all_spender_limits()</code></a>.</p>
<p>Response: <a href="../../primitives/sentry/struct.AllSpendersResponse.html"><code>AllSpendersResponse</code></a></p>
<h6 id="examples-3"><a href="#examples-3">Examples</a></h6>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::AllSpendersResponse;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="kw">let </span>json = <span class="macro">json!</span>({
        <span class="string">&quot;spenders&quot;</span>: {
            <span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>: {
                <span class="string">&quot;totalDeposited&quot;</span>: <span class="string">&quot;10000000000&quot;</span>,
                <span class="string">&quot;totalSpent&quot;</span>: <span class="string">&quot;100000000&quot;</span>,
            },
            <span class="string">&quot;0xDd589B43793934EF6Ad266067A0d1D4896b0dff0&quot;</span>: {
                <span class="string">&quot;totalDeposited&quot;</span>: <span class="string">&quot;90000000000&quot;</span>,
                <span class="string">&quot;totalSpent&quot;</span>: <span class="string">&quot;20000000000&quot;</span>,
            },
            <span class="string">&quot;0x541b401362Ea1D489D322579552B099e801F3632&quot;</span>: {
                <span class="string">&quot;totalDeposited&quot;</span>: <span class="string">&quot;1000000000&quot;</span>,
                <span class="string">&quot;totalSpent&quot;</span>: <span class="string">&quot;1000000000&quot;</span>,
            },
        },
        <span class="string">&quot;totalPages&quot;</span>: <span class="number">1</span>,
        <span class="string">&quot;page&quot;</span>: <span class="number">0
    </span>});
    <span class="macro">assert!</span>(from_value::&lt;AllSpendersResponse&gt;(json).is_ok());
}</code></pre></div>
<h5 id="get-v5channelidvalidator-messages"><a href="#get-v5channelidvalidator-messages">GET <code>/v5/channel/:id/validator-messages</code></a></h5>
<p>Retrieve the latest validator <a href="../../primitives/validator/messages/enum.MessageTypes.html"><code>MessageTypes</code></a> for a given <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a>.</p>
<p>The query <code>limit</code> parameter is constraint to a maximum of <a href="../../primitives/config/struct.Config.html#structfield.msgs_find_limit"><code>Config.msgs_find_limit</code></a>,
if a large value is passed it will use the <a href="../../primitives/config/struct.Config.html#structfield.msgs_find_limit"><code>Config.msgs_find_limit</code></a> instead.</p>
<p><strong>Sub-routes</strong> with additional filtering:</p>
<ul>
<li>GET <code>/v5/channel/:id/validator-messages/:addr</code> - filter by the given <a href="../../primitives/validator/struct.ValidatorId.html"><code>ValidatorId</code></a></li>
<li>GET <code>/v5/channel/:id/validator-messages/:addr/:validator_messages</code> - filters by the given <a href="../../primitives/validator/struct.ValidatorId.html"><code>ValidatorId</code></a> and
validator <a href="../../primitives/validator/messages/enum.MessageTypes.html"><code>MessageTypes</code></a>.
<ul>
<li>
<p><code>:validator_messages</code> - url encoded list of Validator <a href="../../primitives/validator/messages/enum.MessageTypes.html"><code>MessageTypes</code></a> separated by a <code>+</code>.</p>
<p>E.g. <code>NewState+ApproveState</code> becomes <code>NewState%2BApproveState</code></p>
</li>
</ul>
</li>
</ul>
<p>The route is handled by <a href="channel/validator_message/fn.list_validator_messages.html" title="channel::validator_message::list_validator_messages()"><code>channel::validator_message::list_validator_messages()</code></a>.</p>
<p>Request query parameters: <a href="../../primitives/sentry/struct.ValidatorMessagesListQuery.html"><code>ValidatorMessagesListQuery</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.ValidatorMessagesListResponse.html"><code>ValidatorMessagesListResponse</code></a></p>
<h6 id="examples-4"><a href="#examples-4">Examples</a></h6>
<p>Query:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::ValidatorMessagesListQuery;

<span class="kw">fn </span>main() {
    <span class="comment">// Empty query - default values only
    </span>{
        <span class="kw">let </span>empty_query = <span class="string">&quot;&quot;</span>;
        <span class="kw">let </span>query: ValidatorMessagesListQuery = serde_qs::from_str(empty_query).unwrap();

        <span class="macro">assert_eq!</span>(<span class="prelude-val">None</span>, query.limit);
    }
    <span class="comment">// Query with set limit
    </span>{
        <span class="kw">let </span>query_str = <span class="string">&quot;limit=200&quot;</span>;
        <span class="kw">let </span>query: ValidatorMessagesListQuery = serde_qs::from_str(query_str).unwrap();

        <span class="macro">assert_eq!</span>(<span class="prelude-val">Some</span>(<span class="number">200</span>), query.limit);
    }
}</code></pre></div>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::ValidatorMessagesListResponse;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="comment">// This response is generated using the Ethereum Adapter
    </span><span class="kw">let </span>response_json = <span class="macro">json!</span>({
        <span class="string">&quot;messages&quot;</span>: [
            {
                <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:43.110Z&quot;</span>,
                <span class="string">&quot;msg&quot;</span>: {
                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ApproveState&quot;</span>,
                    <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                    <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0xb2ce0010ad5867a4fb4acbde6525c261d76b592d290cb22af120573565168a2e49381e84d4f409c0989fa171dd687bf68b7eeff5b595c845cec8e9b8b1738dbd1c&quot;</span>,
                    <span class="string">&quot;isHealthy&quot;</span>: <span class="bool-val">true
                </span>}
            },
            {
                <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:38.090Z&quot;</span>,
                <span class="string">&quot;msg&quot;</span>: {
                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;NewState&quot;</span>,
                    <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                    <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x508bef21e91d5337ad71791503748fe0d7ee7592db90179be6f948570290d00b72e103b0d262452809ace183ebf83375072b4a359b6e441f2ad6f58b8552c8fa1b&quot;</span>,
                    <span class="string">&quot;earners&quot;</span>: {
                        <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>: <span class="string">&quot;5&quot;</span>,
                        <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>: <span class="string">&quot;100000&quot;</span>,
                        <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>: <span class="string">&quot;3&quot;
                    </span>},
                    <span class="string">&quot;spenders&quot;</span>: {
                     <span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>: <span class="string">&quot;100008&quot;
                    </span>}
                }
            },
            {
                <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:28.160Z&quot;</span>,
                <span class="string">&quot;msg&quot;</span>: {
                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Heartbeat&quot;</span>,
                    <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x3afda200de4ac36d5c8f1a53da0ffdca5077b556a53fb56bb9a79def1c06f972547b0099731b1ac9b4a26c183e2ea66b8cd1759cdc1513e3436d182e9592ae0e1b&quot;</span>,
                    <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;fa8f11b8aa6322905846f96219c855920b4449b18f0ceea97552e3880c5e4a9a&quot;</span>,
                    <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2022-08-09T14:45:28.121225273Z&quot;
                </span>}
            }
        ]
    });

    <span class="kw">let </span>response: ValidatorMessagesListResponse =
        from_value(response_json).expect(<span class="string">&quot;Should deserialize&quot;</span>);

    <span class="macro">println!</span>(<span class="string">&quot;{response:#?}&quot;</span>);
}</code></pre></div>
<h5 id="post-v5channelidvalidator-messages-auth-required"><a href="#post-v5channelidvalidator-messages-auth-required">POST <code>/v5/channel/:id/validator-messages</code> (auth required)</a></h5>
<p>Create new validator <a href="../../primitives/validator/messages/enum.MessageTypes.html"><code>MessageTypes</code></a> for the given <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a>,
used when propagating messages from the validator worker.</p>
<p><strong>Authentication is required</strong> to validate that the <a href="../struct.Auth.html#structfield.uid"><code>Auth.uid</code></a> is either
the <a href="../../primitives/channel/struct.Channel.html#structfield.leader"><code>Channel.leader</code></a> or <a href="../../primitives/channel/struct.Channel.html#structfield.follower"><code>Channel.follower</code></a>.</p>
<p>The route is handled by <a href="channel/validator_message/fn.create_validator_messages.html" title="channel::validator_message::create_validator_messages()"><code>channel::validator_message::create_validator_messages()</code></a>.</p>
<p>Request body (json): <a href="../../primitives/sentry/struct.ValidatorMessagesCreateRequest.html"><code>ValidatorMessagesCreateRequest</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.SuccessResponse.html"><code>SuccessResponse</code></a></p>
<h6 id="examples-5"><a href="#examples-5">Examples</a></h6>
<p>Request:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::ValidatorMessagesCreateRequest;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="comment">// This request is generated using the Ethereum Adapter
    </span><span class="kw">let </span>request_json = <span class="macro">json!</span>({
        <span class="string">&quot;messages&quot;</span>: [
            {
                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ApproveState&quot;</span>,
                <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0xb2ce0010ad5867a4fb4acbde6525c261d76b592d290cb22af120573565168a2e49381e84d4f409c0989fa171dd687bf68b7eeff5b595c845cec8e9b8b1738dbd1c&quot;</span>,
                <span class="string">&quot;isHealthy&quot;</span>: <span class="bool-val">true
            </span>},
            {
                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;NewState&quot;</span>,
                <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x508bef21e91d5337ad71791503748fe0d7ee7592db90179be6f948570290d00b72e103b0d262452809ace183ebf83375072b4a359b6e441f2ad6f58b8552c8fa1b&quot;</span>,
                <span class="string">&quot;earners&quot;</span>: {
                    <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>: <span class="string">&quot;5&quot;</span>,
                    <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>: <span class="string">&quot;100000&quot;</span>,
                    <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>: <span class="string">&quot;3&quot;
                </span>},
                <span class="string">&quot;spenders&quot;</span>: {
                    <span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>: <span class="string">&quot;100008&quot;
                </span>}
            },
            {
                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Heartbeat&quot;</span>,
                <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x3afda200de4ac36d5c8f1a53da0ffdca5077b556a53fb56bb9a79def1c06f972547b0099731b1ac9b4a26c183e2ea66b8cd1759cdc1513e3436d182e9592ae0e1b&quot;</span>,
                <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;fa8f11b8aa6322905846f96219c855920b4449b18f0ceea97552e3880c5e4a9a&quot;</span>,
                <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2022-08-09T14:45:28.121225273Z&quot;
            </span>}
        ]
    });

    <span class="kw">let </span>request: ValidatorMessagesCreateRequest =
        from_value(request_json).expect(<span class="string">&quot;Should deserialize&quot;</span>);

    <span class="macro">println!</span>(<span class="string">&quot;{request:#?}&quot;</span>);
}</code></pre></div>
<h5 id="get-v5channelidlast-approved"><a href="#get-v5channelidlast-approved">GET <code>/v5/channel/:id/last-approved</code></a></h5>
<p>Retrieves the latest <a href="../../primitives/validator/messages/struct.ApproveState.html"><code>ApproveState</code></a> and the corresponding <a href="../../primitives/validator/messages/struct.NewState.html"><code>NewState</code></a>
validator messages for the given <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a>.</p>
<p>If the <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a> is new one or both of the states might have not been generated yet.</p>
<p>The same is true of the <a href="../../primitives/validator/messages/struct.Heartbeat.html"><code>Heartbeat</code></a>s messages if they are requested with the query parameter.</p>
<p>Retrieves the latest <a href="../../primitives/validator/messages/struct.ApproveState.html"><code>ApproveState</code></a> and the corresponding <a href="../../primitives/validator/messages/struct.NewState.html"><code>NewState</code></a>
validator messages for the given <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a>.</p>
<p>If the <a href="../../primitives/channel/struct.Channel.html"><code>Channel</code></a> is new one or both of the states might have not been generated yet.</p>
<p>The same is true of the <a href="../../primitives/validator/messages/struct.Heartbeat.html"><code>Heartbeat</code></a>s messages if they are requested with the query parameter.</p>
<p>The route is handled by <a href="channel/fn.last_approved.html" title="channel::last_approved()"><code>channel::last_approved()</code></a>.</p>
<p>Request query parameters: <a href="../../primitives/sentry/struct.LastApprovedQuery.html" title="primitives::sentry::LastApprovedQuery"><code>LastApprovedQuery</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.LastApprovedResponse.html" title="primitives::sentry::LastApprovedResponse"><code>LastApprovedResponse</code></a></p>
<h6 id="examples-6"><a href="#examples-6">Examples</a></h6>
<p>Query:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::LastApprovedQuery;

<span class="kw">fn </span>main() {
    <span class="comment">// An empty query - no heartbeats will be included in the response (default).
    </span>{
        <span class="comment">// This is treated the same as `withHeartbeat=false` in the route.
        </span><span class="kw">let </span>empty = <span class="string">&quot;&quot;</span>;
        <span class="kw">let </span>empty_expected = LastApprovedQuery {
            with_heartbeat: <span class="prelude-val">None</span>,
        };

        <span class="macro">assert_eq!</span>(empty_expected, serde_qs::from_str(empty).unwrap());
    }

    <span class="comment">// Query with `with_heartbeat` parameter - latest 2 Heartbeats from
    // each Channel Validator will be returned in the response.
    </span>{
        <span class="kw">let </span>with_heartbeat = <span class="string">&quot;withHeartbeat=true&quot;</span>;
        <span class="kw">let </span>with_heartbeat_expected = LastApprovedQuery {
            with_heartbeat: <span class="prelude-val">Some</span>(<span class="bool-val">true</span>),
        };

        <span class="macro">assert_eq!</span>(
            with_heartbeat_expected,
            serde_qs::from_str(with_heartbeat).unwrap()
        );
    }
}</code></pre></div>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{balances::UncheckedState, sentry::LastApprovedResponse};
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="comment">// An empty response - Channel is brand new and neither an NewState nor a ApproveState
    // have been generated yet.
    // This is threated the same as `with_heartbeat=false` in the route.
    </span>{
        <span class="kw">let </span>empty_json = <span class="macro">json!</span>({});

        <span class="kw">let </span>empty_expected = LastApprovedResponse::&lt;UncheckedState&gt; {
            last_approved: <span class="prelude-val">None</span>,
            heartbeats: <span class="prelude-val">None</span>,
        };

        <span class="macro">assert_eq!</span>(
            empty_expected,
            from_value(empty_json).expect(<span class="string">&quot;Should deserialize&quot;</span>)
        );
    }

    <span class="comment">// Response without `with_heartbeat=true` query parameter
    // or with a `with_heartbeat=false` query parameter
    </span>{
        <span class="kw">let </span>response_json = <span class="macro">json!</span>({
            <span class="string">&quot;lastApproved&quot;</span>: {
                <span class="string">&quot;newState&quot;</span>: {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:38.090Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;NewState&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x508bef21e91d5337ad71791503748fe0d7ee7592db90179be6f948570290d00b72e103b0d262452809ace183ebf83375072b4a359b6e441f2ad6f58b8552c8fa1b&quot;</span>,
                        <span class="string">&quot;earners&quot;</span>: {
                            <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>: <span class="string">&quot;5&quot;</span>,
                            <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>: <span class="string">&quot;100000&quot;</span>,
                            <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>: <span class="string">&quot;3&quot;
                        </span>},
                        <span class="string">&quot;spenders&quot;</span>: {
                            <span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>: <span class="string">&quot;100008&quot;
                        </span>}
                    }
                },
                <span class="string">&quot;approveState&quot;</span>: {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:43.110Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ApproveState&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0xb2ce0010ad5867a4fb4acbde6525c261d76b592d290cb22af120573565168a2e49381e84d4f409c0989fa171dd687bf68b7eeff5b595c845cec8e9b8b1738dbd1c&quot;</span>,
                        <span class="string">&quot;isHealthy&quot;</span>: <span class="bool-val">true
                    </span>}
                }
            }
        });

        <span class="kw">let </span>response: LastApprovedResponse&lt;UncheckedState&gt; =
            from_value(response_json).expect(<span class="string">&quot;Should deserialize&quot;</span>);
        <span class="macro">assert!</span>(response.heartbeats.is_none());
    }

    {
        <span class="kw">let </span>response_json = <span class="macro">json!</span>({
            <span class="string">&quot;lastApproved&quot;</span>: {
                <span class="string">&quot;newState&quot;</span>: {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:38.090Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;NewState&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x508bef21e91d5337ad71791503748fe0d7ee7592db90179be6f948570290d00b72e103b0d262452809ace183ebf83375072b4a359b6e441f2ad6f58b8552c8fa1b&quot;</span>,
                        <span class="string">&quot;earners&quot;</span>: {
                            <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>: <span class="string">&quot;5&quot;</span>,
                            <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>: <span class="string">&quot;100000&quot;</span>,
                            <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>: <span class="string">&quot;3&quot;
                        </span>},
                        <span class="string">&quot;spenders&quot;</span>: {
                            <span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>: <span class="string">&quot;100008&quot;
                        </span>}
                    }
                },
                <span class="string">&quot;approveState&quot;</span>: {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:43.110Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ApproveState&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;a1e2f6ee08185ae06e3212e56ad1e0fcbae95ac8939871eb96e1ee3016234321&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0xb2ce0010ad5867a4fb4acbde6525c261d76b592d290cb22af120573565168a2e49381e84d4f409c0989fa171dd687bf68b7eeff5b595c845cec8e9b8b1738dbd1c&quot;</span>,
                        <span class="string">&quot;isHealthy&quot;</span>: <span class="bool-val">true
                    </span>}
                }
            },
            <span class="string">&quot;heartbeats&quot;</span>: [
                {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:58.110Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Heartbeat&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0xc96ed701fc53e27cb28b323c26060273a5bdbad07c4b5470d8090c6a8b03954422b5d0dcc791cc47b5e4186045f60971d7e8e4d69b380cf250fe416cf4aac6901b&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;888f915d6b84ccfa80d3cc6536021efab05f63293ddfb66f1bb1c191909d1372&quot;</span>,
                        <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2022-08-09T14:45:58.097376454Z&quot;
                    </span>}
                },
                {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:28.090Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Heartbeat&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x3f780e2abe0d704428a7921c2f18c070ad503953ef248f533b4ad13fa97c239c5e43a9f3db5077b24d4912cb13367337dc4a6c26976a15811a728e316e7275c41c&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;799c72322f9c35840c4bf41045df2623b33a97a5dfa3994022389ddf8930aac6&quot;</span>,
                        <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2022-08-09T14:45:28.084928288Z&quot;
                    </span>}
                },
                {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:46:03.170Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Heartbeat&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0xd4ce3c8e1cc8ab690cddc2a6cd229311e91e13a53e59b1ec80d8f877afd241af2c86c5fade37be5057d36c8fc5e69d3222b49b98bf686ee00e73005cc280ebc41b&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;d0dc740d3352cdd7da9b823aa4051830f9757fae66c553a88176ce0001e378fb&quot;</span>,
                        <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2022-08-09T14:46:03.127887835Z&quot;
                    </span>}
                },
                {
                    <span class="string">&quot;from&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                    <span class="string">&quot;received&quot;</span>: <span class="string">&quot;2022-08-09T14:45:28.160Z&quot;</span>,
                    <span class="string">&quot;msg&quot;</span>: {
                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Heartbeat&quot;</span>,
                        <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;0x3afda200de4ac36d5c8f1a53da0ffdca5077b556a53fb56bb9a79def1c06f972547b0099731b1ac9b4a26c183e2ea66b8cd1759cdc1513e3436d182e9592ae0e1b&quot;</span>,
                        <span class="string">&quot;stateRoot&quot;</span>: <span class="string">&quot;fa8f11b8aa6322905846f96219c855920b4449b18f0ceea97552e3880c5e4a9a&quot;</span>,
                        <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2022-08-09T14:45:28.121225273Z&quot;
                    </span>}
                }
            ]
        });

        <span class="kw">let </span>response: LastApprovedResponse&lt;UncheckedState&gt; =
            from_value(response_json).expect(<span class="string">&quot;Should deserialize&quot;</span>);

        <span class="macro">assert!</span>(response.heartbeats.is_some());
    }
}</code></pre></div>
<h5 id="post-v5channelidpay-auth-required"><a href="#post-v5channelidpay-auth-required">POST <code>/v5/channel/:id/pay</code> (auth required)</a></h5>
<p>Channel Payout with authentication of the spender.</p>
<p>This route handles withdrawals of advertiser funds for the authenticated spender.
It needs to ensure all campaigns are closed. It accepts a JSON body in the request which contains
all of the earners and updates their balances accordingly. Used when an advertiser/spender wants
to get their remaining funds back.</p>
<p>The route is handled by <a href="channel/fn.channel_payout.html" title="channel::channel_payout()"><code>channel::channel_payout()</code></a>.</p>
<p>Request JSON body: <a href="../../primitives/sentry/struct.ChannelPayRequest.html"><code>ChannelPayRequest</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.SuccessResponse.html"><code>SuccessResponse</code></a></p>
<h6 id="examples-7"><a href="#examples-7">Examples</a></h6>
<p>Request (json):</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::ChannelPayRequest;
<span class="kw">use </span>serde_json::json;

<span class="kw">fn </span>main() {
    <span class="kw">let </span>channel_pay_json = <span class="macro">json!</span>({
      <span class="string">&quot;payouts&quot;</span>: {
        <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>: <span class="string">&quot;10000000000&quot;</span>,
        <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>: <span class="string">&quot;20000000000&quot;</span>,
        <span class="string">&quot;0x0e880972A4b216906F05D67EeaaF55d16B5EE4F1&quot;</span>: <span class="string">&quot;30000000000&quot;</span>,
      },
    });

    <span class="kw">let </span>channel_pay_json = serde_json::to_string(<span class="kw-2">&amp;</span>channel_pay_json).expect(<span class="string">&quot;should serialize&quot;</span>);

    <span class="macro">assert!</span>(serde_json::from_str::&lt;ChannelPayRequest&gt;(<span class="kw-2">&amp;</span>channel_pay_json).is_ok());
}</code></pre></div>
<h5 id="get-v5channelidget-leaf"><a href="#get-v5channelidget-leaf">GET `/v5/channel/:id/get-leaf</a></h5>
<p>This route gets the latest approved state (<a href="../../primitives/validator/messages/struct.NewState.html"><code>NewState</code></a>/<a href="../../primitives/validator/messages/struct.ApproveState.html"><code>ApproveState</code></a> pair),
finds the given <code>spender</code> or <code>earner</code> in the balances tree and produces a Merkle proof for it.
This is useful for the Platform to verify if a spender leaf really exists.</p>
<p>The route is handled by <a href="channel/fn.get_leaf.html" title="channel::get_leaf()"><code>channel::get_leaf()</code></a>.</p>
<p>Response: <a href="../../primitives/sentry/struct.GetLeafResponse.html"><code>GetLeafResponse</code></a></p>
<h6 id="routes-1"><a href="#routes-1">Routes:</a></h6>
<ul>
<li>GET <code>/v5/channel/:id/get-leaf/spender/:addr</code></li>
<li>GET <code>/v5/channel/:id/get-leaf/earner/:addr</code></li>
</ul>
<h6 id="examples-8"><a href="#examples-8">Examples:</a></h6>
<p>URI for retrieving leaf of a Spender:</p>
<p><code>/v5/channel/0xf147fa3f1c5e5e06d359c15aa082442cc3e0380f306306022d1e9047c565a0f9/get-leaf/spender/0xDd589B43793934EF6Ad266067A0d1D4896b0dff0</code></p>
<p>URI for retrieving leaf of an Earner:</p>
<p><code>/v5/channel/0xf147fa3f1c5e5e06d359c15aa082442cc3e0380f306306022d1e9047c565a0f9/get-leaf/earner/0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9</code></p>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::GetLeafResponse;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="kw">let </span>json = <span class="macro">json!</span>({
        <span class="string">&quot;merkleProof&quot;</span>: <span class="string">&quot;8ea7760ca2dbbe00673372afbf8b05048717ce8a305f1f853afac8c244182e0c&quot;</span>,
    });

    <span class="macro">assert!</span>(from_value::&lt;GetLeafResponse&gt;(json).is_ok());
}</code></pre></div>
<h5 id="post-v5channeldummy-deposit-auth-required"><a href="#post-v5channeldummy-deposit-auth-required">POST <code>/v5/channel/dummy-deposit</code> (auth required)</a></h5>
<p>Set a deposit for a Channel and depositor (the authenticated address) in the Dummy adapter.</p>
<p><strong>NOTE:</strong> This route is available <strong>only</strong> when using the Dummy adapter and it’s not
an official production route!</p>
<p>The route is handled by <a href="channel/fn.channel_dummy_deposit.html" title="channel::channel_dummy_deposit()"><code>channel::channel_dummy_deposit()</code></a>.</p>
<p>Request body (json): <a href="channel/struct.ChannelDummyDeposit.html"><code>ChannelDummyDeposit</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.SuccessResponse.html"><code>SuccessResponse</code></a></p>
<h6 id="examples-9"><a href="#examples-9">Examples</a></h6>
<p>Request:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{unified_num::FromWhole, UnifiedNum};
<span class="kw">use </span>sentry::routes::channel::ChannelDummyDeposit;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="kw">let </span>request_json = <span class="macro">json!</span>({
        <span class="string">&quot;channel&quot;</span>: {
            <span class="string">&quot;leader&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
            <span class="string">&quot;follower&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
            <span class="string">&quot;guardian&quot;</span>: <span class="string">&quot;0xe061E1EB461EaBE512759aa18A201B20Fe90631D&quot;</span>,
            <span class="string">&quot;token&quot;</span>: <span class="string">&quot;0x2bcaf6968aec8a3b5126fbfab5fd419da6e8ad8e&quot;</span>,
            <span class="string">&quot;nonce&quot;</span>: <span class="string">&quot;0&quot;
          </span>},
        <span class="string">&quot;deposit&quot;</span>: {
            <span class="string">&quot;total&quot;</span>: <span class="string">&quot;20000000000000&quot;
        </span>}
    });

    <span class="kw">let </span>request: ChannelDummyDeposit = from_value(request_json).expect(<span class="string">&quot;Should deserialize&quot;</span>);

    <span class="macro">assert_eq!</span>(UnifiedNum::from_whole(<span class="number">200000.0</span>), request.deposit.total);

    <span class="macro">println!</span>(<span class="string">&quot;{request:#?}&quot;</span>);
}</code></pre></div>
<h3 id="campaign"><a href="#campaign">Campaign</a></h3>
<p>All routes are implemented under the module <a href="campaign/index.html" title="campaign">campaign</a>.</p>
<h4 id="route-parameters-1"><a href="#route-parameters-1">Route parameters</a></h4>
<p>Paths which include these parameters are validated as follow:</p>
<ul>
<li><code>:id</code> - <a href="../../primitives/campaign/campaign_id/struct.CampaignId.html"><code>CampaignId</code></a></li>
</ul>
<h4 id="routes-2"><a href="#routes-2">Routes</a></h4><h5 id="get-v5campaignlist"><a href="#get-v5campaignlist">GET <code>/v5/campaign/list</code></a></h5>
<p>Lists all campaigns with pagination and orders them in
ascending order (<code>ASC</code>) by <code>Campaign.created</code>.
This ensures that the order in the pages will not change if a new
<code>Campaign</code> is created while still retrieving a page.</p>
<p>The route is handled by <a href="campaign/fn.campaign_list.html" title="campaign::campaign_list()"><code>campaign::campaign_list()</code></a>.</p>
<p>Request query parameters: <a href="../../primitives/sentry/campaign_list/struct.CampaignListQuery.html"><code>CampaignListQuery</code></a></p>
<ul>
<li><code>page=[integer]</code> (optional) default: <code>0</code></li>
<li><code>creator=[0x....]</code> (optional) - address of the creator to be filtered by</li>
<li><code>activeTo=[integer]</code> (optional) in seconds - filters campaigns by <code>Campaign.active.to &gt; query.activeTo</code></li>
<li><code>validator=[0x...]</code> or <code>leader=[0x...]</code> (optional) - address of the validator to be filtered by. You can either
<ul>
<li><code>validator=[0x...]</code> - it will return all <code>Campaign</code>s where this address is <strong>either</strong> <code>Channel.leader</code> or <code>Channel.follower</code></li>
<li><code>leader=[0x...]</code> - it will return all <code>Campaign</code>s where this address is <code>Channel.leader</code></li>
</ul>
</li>
</ul>
<p>Response: <a href="../../primitives/sentry/campaign_list/struct.CampaignListResponse.html"><code>CampaignListResponse</code></a></p>
<h6 id="examples-10"><a href="#examples-10">Examples</a></h6>
<p>Query:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>chrono::{TimeZone, Utc};
<span class="kw">use </span>primitives::{
    sentry::campaign_list::{CampaignListQuery, ValidatorParam},
    test_util::{ADVERTISER, FOLLOWER, IDS, LEADER},
};

<span class="kw">fn </span>main() {
    <span class="comment">// Empty query - default values only
    </span>{
        <span class="kw">let </span>empty_query = <span class="string">&quot;&quot;</span>;
        <span class="kw">let </span>query: CampaignListQuery = serde_qs::from_str(empty_query).unwrap();

        <span class="macro">assert_eq!</span>(<span class="number">0</span>, query.page);
        <span class="macro">assert!</span>(
            Utc::now() &gt;= query.active_to_ge,
            <span class="string">&quot;By default `activeTo` is set to `Utc::now()`&quot;
        </span>);
        <span class="macro">assert!</span>(query.creator.is_none());
        <span class="macro">assert!</span>(query.validator.is_none());
    }

    <span class="comment">// In the following examples we always use `activeTo`
    // as it makes simpler examples for assertions rather than using the default `Utc::now()`

    // Query with `activeTo` only
    </span>{
        <span class="kw">let </span>active_to_query = <span class="string">&quot;activeTo=1624192200&quot;</span>;
        <span class="kw">let </span>active_to = CampaignListQuery {
            page: <span class="number">0</span>,
            active_to_ge: Utc.ymd(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">20</span>).and_hms(<span class="number">12</span>, <span class="number">30</span>, <span class="number">0</span>),
            creator: <span class="prelude-val">None</span>,
            validator: <span class="prelude-val">None</span>,
        };

        <span class="macro">assert_eq!</span>(active_to, serde_qs::from_str(active_to_query).unwrap());
    }

    <span class="comment">// Query with `page` &amp; `activeTo`
    </span>{
        <span class="kw">let </span>with_page_query = <span class="string">&quot;page=14&amp;activeTo=1624192200&quot;</span>;
        <span class="kw">let </span>with_page = CampaignListQuery {
            page: <span class="number">14</span>,
            active_to_ge: Utc.ymd(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">20</span>).and_hms(<span class="number">12</span>, <span class="number">30</span>, <span class="number">0</span>),
            creator: <span class="prelude-val">None</span>,
            validator: <span class="prelude-val">None</span>,
        };

        <span class="macro">assert_eq!</span>(with_page, serde_qs::from_str(with_page_query).unwrap());
    }

    <span class="comment">// Query with `creator`
    </span>{
        <span class="kw">let </span>with_creator_query =
            <span class="string">&quot;activeTo=1624192200&amp;creator=0xDd589B43793934EF6Ad266067A0d1D4896b0dff0&quot;</span>;

        <span class="kw">let </span>with_creator = CampaignListQuery {
            page: <span class="number">0</span>,
            active_to_ge: Utc.ymd(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">20</span>).and_hms(<span class="number">12</span>, <span class="number">30</span>, <span class="number">0</span>),
            creator: <span class="prelude-val">Some</span>(<span class="kw-2">*</span>ADVERTISER),
            validator: <span class="prelude-val">None</span>,
        };

        <span class="macro">assert_eq!</span>(
            with_creator,
            serde_qs::from_str(with_creator_query).unwrap()
        );
    }

    <span class="comment">// Query with `validator`
    // You can either have `leader` or `validator` but not both!
    </span>{
        <span class="kw">let </span>with_creator_validator_query =
            <span class="string">&quot;activeTo=1624192200&amp;validator=0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>;
        <span class="kw">let </span>with_creator_validator = CampaignListQuery {
            page: <span class="number">0</span>,
            active_to_ge: Utc.ymd(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">20</span>).and_hms(<span class="number">12</span>, <span class="number">30</span>, <span class="number">0</span>),
            creator: <span class="prelude-val">None</span>,
            validator: <span class="prelude-val">Some</span>(ValidatorParam::Validator(IDS[<span class="kw-2">&amp;</span>FOLLOWER])),
        };

        <span class="macro">assert_eq!</span>(
            with_creator_validator,
            serde_qs::from_str(with_creator_validator_query).unwrap()
        );
    }

    <span class="comment">// Query with `leader`
    // You can either have `leader` or `validator` but not both!
    </span>{
        <span class="kw">let </span>with_leader_query =
            <span class="string">&quot;activeTo=1624192200&amp;leader=0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>;

        <span class="kw">let </span>with_leader = CampaignListQuery {
            page: <span class="number">0</span>,
            active_to_ge: Utc.ymd(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">20</span>).and_hms(<span class="number">12</span>, <span class="number">30</span>, <span class="number">0</span>),
            creator: <span class="prelude-val">None</span>,
            validator: <span class="prelude-val">Some</span>(ValidatorParam::Leader(IDS[<span class="kw-2">&amp;</span>LEADER])),
        };

        <span class="macro">assert_eq!</span>(with_leader, serde_qs::from_str(with_leader_query).unwrap());
    }

    <span class="comment">// Query with all parameters and `validator`
    // You can either have `leader` or `validator` but not both!
    </span>{
        <span class="kw">let </span>full_query = <span class="string">&quot;page=14&amp;activeTo=1624192200&amp;creator=0xDd589B43793934EF6Ad266067A0d1D4896b0dff0&amp;validator=0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>;
        <span class="kw">let </span>full_expected = CampaignListQuery {
            page: <span class="number">14</span>,
            active_to_ge: Utc.ymd(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">20</span>).and_hms(<span class="number">12</span>, <span class="number">30</span>, <span class="number">0</span>),
            creator: <span class="prelude-val">Some</span>(<span class="kw-2">*</span>ADVERTISER),
            validator: <span class="prelude-val">Some</span>(ValidatorParam::Validator(IDS[<span class="kw-2">&amp;</span>FOLLOWER])),
        };

        <span class="macro">assert_eq!</span>(full_expected, serde_qs::from_str(full_query).unwrap());
    }
}</code></pre></div>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::campaign_list::CampaignListResponse;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="kw">let </span>json = <span class="macro">json!</span>({
      <span class="string">&quot;campaigns&quot;</span>: [
        {
          <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0x936da01f9abd4d9d80c702af85c822a8&quot;</span>,
          <span class="string">&quot;channel&quot;</span>: {
            <span class="string">&quot;leader&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
            <span class="string">&quot;follower&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
            <span class="string">&quot;guardian&quot;</span>: <span class="string">&quot;0xe061E1EB461EaBE512759aa18A201B20Fe90631D&quot;</span>,
            <span class="string">&quot;token&quot;</span>: <span class="string">&quot;0x2BCaf6968aEC8A3b5126FBfAb5Fd419da6E8AD8E&quot;</span>,
            <span class="string">&quot;nonce&quot;</span>: <span class="string">&quot;0&quot;
          </span>},
          <span class="string">&quot;creator&quot;</span>: <span class="string">&quot;0xDd589B43793934EF6Ad266067A0d1D4896b0dff0&quot;</span>,
          <span class="string">&quot;budget&quot;</span>: <span class="string">&quot;15000000000&quot;</span>,
          <span class="string">&quot;validators&quot;</span>: [
            {
              <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
              <span class="string">&quot;fee&quot;</span>: <span class="string">&quot;500000000&quot;</span>,
              <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://localhost:8005/&quot;
            </span>},
            {
              <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
              <span class="string">&quot;fee&quot;</span>: <span class="string">&quot;400000000&quot;</span>,
              <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://localhost:8006/&quot;
            </span>}
          ],
          <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy Campaign&quot;</span>,
          <span class="string">&quot;pricingBounds&quot;</span>: {
            <span class="string">&quot;CLICK&quot;</span>: {
              <span class="string">&quot;min&quot;</span>: <span class="string">&quot;6000000&quot;</span>,
              <span class="string">&quot;max&quot;</span>: <span class="string">&quot;10000000&quot;
            </span>},
            <span class="string">&quot;IMPRESSION&quot;</span>: {
              <span class="string">&quot;min&quot;</span>: <span class="string">&quot;4000000&quot;</span>,
              <span class="string">&quot;max&quot;</span>: <span class="string">&quot;5000000&quot;
            </span>}
          },
          <span class="string">&quot;eventSubmission&quot;</span>: {
            <span class="string">&quot;allow&quot;</span>: []
          },
          <span class="string">&quot;adUnits&quot;</span>: [
            {
              <span class="string">&quot;ipfs&quot;</span>: <span class="string">&quot;Qmasg8FrbuSQpjFu3kRnZF9beg8rEBFrqgi1uXDRwCbX5f&quot;</span>,
              <span class="string">&quot;type&quot;</span>: <span class="string">&quot;legacy_250x250&quot;</span>,
              <span class="string">&quot;mediaUrl&quot;</span>: <span class="string">&quot;ipfs://QmcUVX7fvoLMM93uN2bD3wGTH8MXSxeL8hojYfL2Lhp7mR&quot;</span>,
              <span class="string">&quot;mediaMime&quot;</span>: <span class="string">&quot;image/jpeg&quot;</span>,
              <span class="string">&quot;targetUrl&quot;</span>: <span class="string">&quot;https://www.adex.network/?stremio-test-banner-1&quot;</span>,
              <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>,
              <span class="string">&quot;created&quot;</span>: <span class="number">1564390800000_u64</span>,
              <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy AdUnit 1&quot;</span>,
              <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Dummy AdUnit description 1&quot;</span>,
              <span class="string">&quot;archived&quot;</span>: <span class="bool-val">false
            </span>},
            {
              <span class="string">&quot;ipfs&quot;</span>: <span class="string">&quot;QmVhRDGXoM3Fg3HZD5xwMuxtb9ZErwC8wHt8CjsfxaiUbZ&quot;</span>,
              <span class="string">&quot;type&quot;</span>: <span class="string">&quot;legacy_250x250&quot;</span>,
              <span class="string">&quot;mediaUrl&quot;</span>: <span class="string">&quot;ipfs://QmQB7uz7Gxfy7wqAnrnBcZFaVJLos8J9gn8mRcHQU6dAi1&quot;</span>,
              <span class="string">&quot;mediaMime&quot;</span>: <span class="string">&quot;image/jpeg&quot;</span>,
              <span class="string">&quot;targetUrl&quot;</span>: <span class="string">&quot;https://www.adex.network/?adex-campaign=true&amp;pub=stremio&quot;</span>,
              <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>,
              <span class="string">&quot;created&quot;</span>: <span class="number">1564390800000_u64</span>,
              <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy AdUnit 2&quot;</span>,
              <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Dummy AdUnit description 2&quot;</span>,
              <span class="string">&quot;archived&quot;</span>: <span class="bool-val">false
            </span>}
          ],
          <span class="string">&quot;targetingRules&quot;</span>: [],
          <span class="string">&quot;created&quot;</span>: <span class="number">1612162800000_u64</span>,
          <span class="string">&quot;activeTo&quot;</span>: <span class="number">4073414400000_u64
        </span>},
        {
          <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0x127b98248f4e4b73af409d10f62daeaa&quot;</span>,
          <span class="string">&quot;channel&quot;</span>: {
            <span class="string">&quot;leader&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
            <span class="string">&quot;follower&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
            <span class="string">&quot;guardian&quot;</span>: <span class="string">&quot;0x79D358a3194d737880B3eFD94ADccD246af9F535&quot;</span>,
            <span class="string">&quot;token&quot;</span>: <span class="string">&quot;0x2BCaf6968aEC8A3b5126FBfAb5Fd419da6E8AD8E&quot;</span>,
            <span class="string">&quot;nonce&quot;</span>: <span class="string">&quot;0&quot;
          </span>},
          <span class="string">&quot;creator&quot;</span>: <span class="string">&quot;0xDd589B43793934EF6Ad266067A0d1D4896b0dff0&quot;</span>,
          <span class="string">&quot;budget&quot;</span>: <span class="string">&quot;2000000000&quot;</span>,
          <span class="string">&quot;validators&quot;</span>: [
            {
              <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
              <span class="string">&quot;fee&quot;</span>: <span class="string">&quot;10000000&quot;</span>,
              <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://localhost:8006/&quot;
            </span>},
            {
              <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
              <span class="string">&quot;fee&quot;</span>: <span class="string">&quot;5000000&quot;</span>,
              <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://localhost:8005/&quot;
            </span>}
          ],
          <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy Campaign 2 in Chain #1337&quot;</span>,
          <span class="string">&quot;pricingBounds&quot;</span>: {
            <span class="string">&quot;CLICK&quot;</span>: {
              <span class="string">&quot;min&quot;</span>: <span class="string">&quot;300000000&quot;</span>,
              <span class="string">&quot;max&quot;</span>: <span class="string">&quot;500000000&quot;
            </span>},
            <span class="string">&quot;IMPRESSION&quot;</span>: {
              <span class="string">&quot;min&quot;</span>: <span class="string">&quot;100000000&quot;</span>,
              <span class="string">&quot;max&quot;</span>: <span class="string">&quot;200000000&quot;
            </span>}
          },
          <span class="string">&quot;eventSubmission&quot;</span>: {
            <span class="string">&quot;allow&quot;</span>: []
          },
          <span class="string">&quot;adUnits&quot;</span>: [
            {
              <span class="string">&quot;ipfs&quot;</span>: <span class="string">&quot;Qmasg8FrbuSQpjFu3kRnZF9beg8rEBFrqgi1uXDRwCbX5f&quot;</span>,
              <span class="string">&quot;type&quot;</span>: <span class="string">&quot;legacy_250x250&quot;</span>,
              <span class="string">&quot;mediaUrl&quot;</span>: <span class="string">&quot;ipfs://QmcUVX7fvoLMM93uN2bD3wGTH8MXSxeL8hojYfL2Lhp7mR&quot;</span>,
              <span class="string">&quot;mediaMime&quot;</span>: <span class="string">&quot;image/jpeg&quot;</span>,
              <span class="string">&quot;targetUrl&quot;</span>: <span class="string">&quot;https://www.adex.network/?stremio-test-banner-1&quot;</span>,
              <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>,
              <span class="string">&quot;created&quot;</span>: <span class="number">1564390800000_u64</span>,
              <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy AdUnit 1&quot;</span>,
              <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Dummy AdUnit description 1&quot;</span>,
              <span class="string">&quot;archived&quot;</span>: <span class="bool-val">false
            </span>},
            {
              <span class="string">&quot;ipfs&quot;</span>: <span class="string">&quot;QmVhRDGXoM3Fg3HZD5xwMuxtb9ZErwC8wHt8CjsfxaiUbZ&quot;</span>,
              <span class="string">&quot;type&quot;</span>: <span class="string">&quot;legacy_250x250&quot;</span>,
              <span class="string">&quot;mediaUrl&quot;</span>: <span class="string">&quot;ipfs://QmQB7uz7Gxfy7wqAnrnBcZFaVJLos8J9gn8mRcHQU6dAi1&quot;</span>,
              <span class="string">&quot;mediaMime&quot;</span>: <span class="string">&quot;image/jpeg&quot;</span>,
              <span class="string">&quot;targetUrl&quot;</span>: <span class="string">&quot;https://www.adex.network/?adex-campaign=true&amp;pub=stremio&quot;</span>,
              <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>,
              <span class="string">&quot;created&quot;</span>: <span class="number">1564390800000_u64</span>,
              <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy AdUnit 2&quot;</span>,
              <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Dummy AdUnit description 2&quot;</span>,
              <span class="string">&quot;archived&quot;</span>: <span class="bool-val">false
            </span>}
          ],
          <span class="string">&quot;targetingRules&quot;</span>: [],
          <span class="string">&quot;created&quot;</span>: <span class="number">1612162800000_u64</span>,
          <span class="string">&quot;activeFrom&quot;</span>: <span class="number">1656280800000_u64</span>,
          <span class="string">&quot;activeTo&quot;</span>: <span class="number">4073414400000_u64
        </span>},
        {
          <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0xa78f3492481b41a688488a7aa1ff17df&quot;</span>,
          <span class="string">&quot;channel&quot;</span>: {
            <span class="string">&quot;leader&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
            <span class="string">&quot;follower&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
            <span class="string">&quot;guardian&quot;</span>: <span class="string">&quot;0x79D358a3194d737880B3eFD94ADccD246af9F535&quot;</span>,
            <span class="string">&quot;token&quot;</span>: <span class="string">&quot;0x12a28f2bfBFfDf5842657235cC058242f40fDEa6&quot;</span>,
            <span class="string">&quot;nonce&quot;</span>: <span class="string">&quot;1&quot;
          </span>},
          <span class="string">&quot;creator&quot;</span>: <span class="string">&quot;0x541b401362Ea1D489D322579552B099e801F3632&quot;</span>,
          <span class="string">&quot;budget&quot;</span>: <span class="string">&quot;2000000000&quot;</span>,
          <span class="string">&quot;validators&quot;</span>: [
            {
              <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
              <span class="string">&quot;fee&quot;</span>: <span class="string">&quot;200000000&quot;</span>,
              <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://localhost:8005/&quot;
            </span>},
            {
              <span class="string">&quot;id&quot;</span>: <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
              <span class="string">&quot;fee&quot;</span>: <span class="string">&quot;175000000&quot;</span>,
              <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://localhost:8006/&quot;
            </span>}
          ],
          <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy Campaign 3 in Chain #1&quot;</span>,
          <span class="string">&quot;pricingBounds&quot;</span>: {
            <span class="string">&quot;CLICK&quot;</span>: {
              <span class="string">&quot;min&quot;</span>: <span class="string">&quot;3500000&quot;</span>,
              <span class="string">&quot;max&quot;</span>: <span class="string">&quot;6500000&quot;
            </span>},
            <span class="string">&quot;IMPRESSION&quot;</span>: {
              <span class="string">&quot;min&quot;</span>: <span class="string">&quot;1500000&quot;</span>,
              <span class="string">&quot;max&quot;</span>: <span class="string">&quot;2500000&quot;
            </span>}
          },
          <span class="string">&quot;eventSubmission&quot;</span>: {
            <span class="string">&quot;allow&quot;</span>: []
          },
          <span class="string">&quot;adUnits&quot;</span>: [
            {
              <span class="string">&quot;ipfs&quot;</span>: <span class="string">&quot;QmYwcpMjmqJfo9ot1jGe9rfXsszFV1WbEA59QS7dEVHfJi&quot;</span>,
              <span class="string">&quot;type&quot;</span>: <span class="string">&quot;legacy_250x250&quot;</span>,
              <span class="string">&quot;mediaUrl&quot;</span>: <span class="string">&quot;ipfs://QmQB7uz7Gxfy7wqAnrnBcZFaVJLos8J9gn8mRcHQU6dAi1&quot;</span>,
              <span class="string">&quot;mediaMime&quot;</span>: <span class="string">&quot;image/jpeg&quot;</span>,
              <span class="string">&quot;targetUrl&quot;</span>: <span class="string">&quot;https://www.adex.network/?adex-campaign=true&quot;</span>,
              <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>,
              <span class="string">&quot;created&quot;</span>: <span class="number">1564390800000_u64</span>,
              <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy AdUnit 3&quot;</span>,
              <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Dummy AdUnit description 3&quot;</span>,
              <span class="string">&quot;archived&quot;</span>: <span class="bool-val">false
            </span>},
            {
              <span class="string">&quot;ipfs&quot;</span>: <span class="string">&quot;QmTAF3FsFDS7Ru8WChoD9ofiHTH8gAQfR4mYSnwxqTDpJH&quot;</span>,
              <span class="string">&quot;type&quot;</span>: <span class="string">&quot;legacy_250x250&quot;</span>,
              <span class="string">&quot;mediaUrl&quot;</span>: <span class="string">&quot;ipfs://QmQAcfBJpDDuH99A4p3pFtUmQwamS8UYStP5HxHC7bgYXY&quot;</span>,
              <span class="string">&quot;mediaMime&quot;</span>: <span class="string">&quot;image/jpeg&quot;</span>,
              <span class="string">&quot;targetUrl&quot;</span>: <span class="string">&quot;https://adex.network&quot;</span>,
              <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>,
              <span class="string">&quot;created&quot;</span>: <span class="number">1564390800000_u64</span>,
              <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Dummy AdUnit 4&quot;</span>,
              <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Dummy AdUnit description 4&quot;</span>,
              <span class="string">&quot;archived&quot;</span>: <span class="bool-val">false
            </span>}
          ],
          <span class="string">&quot;targetingRules&quot;</span>: [],
          <span class="string">&quot;created&quot;</span>: <span class="number">1612162800000_u64</span>,
          <span class="string">&quot;activeTo&quot;</span>: <span class="number">4073414400000_u64
        </span>}
      ],
      <span class="string">&quot;totalPages&quot;</span>: <span class="number">1</span>,
      <span class="string">&quot;page&quot;</span>: <span class="number">0
    </span>});

    <span class="macro">assert!</span>(from_value::&lt;CampaignListResponse&gt;(json).is_ok());
}</code></pre></div>
<h5 id="post-v5campaign-auth-required"><a href="#post-v5campaign-auth-required">POST <code>/v5/campaign</code> (auth required)</a></h5>
<p>Create a new Campaign. Request must be sent by the <a href="../../primitives/campaign/struct.Campaign.html#structfield.creator"><code>Campaign.creator</code></a>.</p>
<p><strong>Authentication is required</strong> to validate <a href="../../primitives/campaign/struct.Campaign.html#structfield.creator"><code>Campaign.creator</code></a> == <a href="../struct.Auth.html#structfield.uid"><code>Auth.uid</code></a></p>
<p>It will make sure the <code>Channel</code> is created if new and it will update
the spendable amount using the <a href="../../adapter/client/trait.Locked.html#tymethod.get_deposit"><code>Adapter.get_deposit()</code></a>.</p>
<p>The route is handled by <a href="campaign/fn.create_campaign.html" title="campaign::create_campaign()"><code>campaign::create_campaign()</code></a>.</p>
<p>Request body (json): <a href="../../primitives/sentry/campaign_create/struct.CreateCampaign.html" title="primitives::sentry::campaign_create::CreateCampaign"><code>CreateCampaign</code></a></p>
<p>Response: <a href="../../primitives/campaign/struct.Campaign.html"><code>Campaign</code></a></p>
<h6 id="examples-11"><a href="#examples-11">Examples</a></h6>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{sentry::campaign_create::CreateCampaign, test_util::DUMMY_CAMPAIGN, CampaignId};
<span class="kw">use </span>serde_json::json;
<span class="kw">use </span>std::str::FromStr;

<span class="kw">fn </span>main() {
    <span class="comment">// CreateCampaign in an HTTP request.
    // A CampaignId will be randomly generated for the newly created Campaign.
    </span>{
        <span class="kw">let </span>create_campaign = CreateCampaign::from_campaign_erased(DUMMY_CAMPAIGN.clone(), <span class="prelude-val">None</span>);

        <span class="kw">let </span>_create_campaign_str =
            serde_json::to_string(<span class="kw-2">&amp;</span>create_campaign).expect(<span class="string">&quot;should serialize&quot;</span>);

        <span class="kw">let </span>create_campaign_json = <span class="macro">json!</span>({
            <span class="string">&quot;channel&quot;</span>:{
                <span class="string">&quot;leader&quot;</span>:<span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                <span class="string">&quot;follower&quot;</span>:<span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                <span class="string">&quot;guardian&quot;</span>:<span class="string">&quot;0xe061E1EB461EaBE512759aa18A201B20Fe90631D&quot;</span>,
                <span class="string">&quot;token&quot;</span>:<span class="string">&quot;0x2BCaf6968aEC8A3b5126FBfAb5Fd419da6E8AD8E&quot;</span>,
                <span class="string">&quot;nonce&quot;</span>:<span class="string">&quot;987654321&quot;
            </span>},
            <span class="string">&quot;creator&quot;</span>:<span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>,
            <span class="string">&quot;budget&quot;</span>:<span class="string">&quot;100000000000&quot;</span>,
            <span class="string">&quot;validators&quot;</span>:[
                {
                    <span class="string">&quot;id&quot;</span>:<span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                    <span class="string">&quot;fee&quot;</span>:<span class="string">&quot;3000000&quot;</span>,
                    <span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://localhost:8005&quot;
                </span>},
                {
                    <span class="string">&quot;id&quot;</span>:<span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                    <span class="string">&quot;fee&quot;</span>:<span class="string">&quot;2000000&quot;</span>,
                    <span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://localhost:8006&quot;
                </span>}
            ],
            <span class="string">&quot;title&quot;</span>:<span class="string">&quot;Dummy Campaign&quot;</span>,
            <span class="string">&quot;pricingBounds&quot;</span>:{
                <span class="string">&quot;CLICK&quot;</span>:{<span class="string">&quot;min&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;max&quot;</span>:<span class="string">&quot;0&quot;</span>},
                <span class="string">&quot;IMPRESSION&quot;</span>:{<span class="string">&quot;min&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;max&quot;</span>:<span class="string">&quot;10&quot;</span>}
            },
            <span class="string">&quot;eventSubmission&quot;</span>:{<span class="string">&quot;allow&quot;</span>:[]},
            <span class="string">&quot;targetingRules&quot;</span>:[],
            <span class="string">&quot;created&quot;</span>:<span class="number">1612162800000_u64</span>,
            <span class="string">&quot;activeTo&quot;</span>:<span class="number">4073414400000_u64
        </span>});

        <span class="kw">let </span>create_campaign_json =
            serde_json::to_string(<span class="kw-2">&amp;</span>create_campaign_json).expect(<span class="string">&quot;should serialize&quot;</span>);

        <span class="kw">let </span>deserialized: CreateCampaign =
            serde_json::from_str(<span class="kw-2">&amp;</span>create_campaign_json).expect(<span class="string">&quot;should deserialize&quot;</span>);

        <span class="macro">assert_eq!</span>(create_campaign, deserialized);
    }

    <span class="comment">// CreateCampaign with a provided ID
    </span>{
        <span class="kw">let </span><span class="kw-2">mut </span>create_campaign =
            CreateCampaign::from_campaign_erased(DUMMY_CAMPAIGN.clone(), <span class="prelude-val">None</span>);
        create_campaign.id = <span class="prelude-val">Some</span>(
            CampaignId::from_str(<span class="string">&quot;0x936da01f9abd4d9d80c702af85c822a8&quot;</span>).expect(<span class="string">&quot;Should be valid id&quot;</span>),
        );

        <span class="kw">let </span>create_campaign_json = <span class="macro">json!</span>({
            <span class="string">&quot;id&quot;</span>:<span class="string">&quot;0x936da01f9abd4d9d80c702af85c822a8&quot;</span>,
            <span class="string">&quot;channel&quot;</span>:{
                <span class="string">&quot;leader&quot;</span>:<span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                <span class="string">&quot;follower&quot;</span>:<span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                <span class="string">&quot;guardian&quot;</span>:<span class="string">&quot;0xe061E1EB461EaBE512759aa18A201B20Fe90631D&quot;</span>,
                <span class="string">&quot;token&quot;</span>:<span class="string">&quot;0x2BCaf6968aEC8A3b5126FBfAb5Fd419da6E8AD8E&quot;</span>,
                <span class="string">&quot;nonce&quot;</span>:<span class="string">&quot;987654321&quot;
            </span>},
            <span class="string">&quot;creator&quot;</span>:<span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>,
            <span class="string">&quot;budget&quot;</span>:<span class="string">&quot;100000000000&quot;</span>,
            <span class="string">&quot;validators&quot;</span>:[
                {
                    <span class="string">&quot;id&quot;</span>:<span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
                    <span class="string">&quot;fee&quot;</span>:<span class="string">&quot;3000000&quot;</span>,
                    <span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://localhost:8005&quot;
                </span>},
                {
                    <span class="string">&quot;id&quot;</span>:<span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
                    <span class="string">&quot;fee&quot;</span>:<span class="string">&quot;2000000&quot;</span>,
                    <span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://localhost:8006&quot;
                </span>}
            ],
            <span class="string">&quot;title&quot;</span>:<span class="string">&quot;Dummy Campaign&quot;</span>,
            <span class="string">&quot;pricingBounds&quot;</span>:{<span class="string">&quot;CLICK&quot;</span>:{<span class="string">&quot;min&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;max&quot;</span>:<span class="string">&quot;0&quot;</span>},<span class="string">&quot;IMPRESSION&quot;</span>:{<span class="string">&quot;min&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;max&quot;</span>:<span class="string">&quot;10&quot;</span>}},
            <span class="string">&quot;eventSubmission&quot;</span>:{<span class="string">&quot;allow&quot;</span>:[]},
            <span class="string">&quot;targetingRules&quot;</span>:[],
            <span class="string">&quot;created&quot;</span>:<span class="number">1612162800000_u64</span>,
            <span class="string">&quot;activeTo&quot;</span>:<span class="number">4073414400000_u64
        </span>});

        <span class="kw">let </span>create_campaign_json =
            serde_json::to_string(<span class="kw-2">&amp;</span>create_campaign_json).expect(<span class="string">&quot;should serialize&quot;</span>);
        <span class="kw">let </span>deserialized: CreateCampaign =
            serde_json::from_str(<span class="kw-2">&amp;</span>create_campaign_json).expect(<span class="string">&quot;should deserialize&quot;</span>);

        <span class="macro">assert_eq!</span>(create_campaign, deserialized);
    }
}</code></pre></div>
<h5 id="post-v5campaignid-auth-required"><a href="#post-v5campaignid-auth-required">POST <code>/v5/campaign/:id</code> (auth required)</a></h5>
<p>Modify the <a href="../../primitives/campaign/struct.Campaign.html"><code>Campaign</code></a>. Request must be sent by the <a href="../../primitives/campaign/struct.Campaign.html#structfield.creator"><code>Campaign.creator</code></a>.</p>
<p><strong>Authentication is required</strong> to validate <a href="../../primitives/campaign/struct.Campaign.html#structfield.creator"><code>Campaign.creator</code></a> == <a href="../struct.Auth.html#structfield.uid"><code>Auth.uid</code></a></p>
<p>The route is handled by <a href="campaign/update_campaign/fn.handle_route.html" title="campaign::update_campaign::handle_route()"><code>campaign::update_campaign::handle_route()</code></a>.</p>
<p>Request body (json): <a href="../../primitives/sentry/campaign_modify/struct.ModifyCampaign.html" title="primitives::sentry::campaign_modify::ModifyCampaign"><code>ModifyCampaign</code></a></p>
<p>Response: <a href="../../primitives/campaign/struct.Campaign.html"><code>Campaign</code></a></p>
<h6 id="examples-12"><a href="#examples-12">Examples</a></h6>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{sentry::campaign_modify::ModifyCampaign, unified_num::FromWhole, UnifiedNum};
<span class="kw">use </span>serde_json::json;

<span class="kw">fn </span>main() {
    {
        <span class="kw">let </span>modify_campaign = ModifyCampaign {
            ad_units: <span class="prelude-val">None</span>,
            budget: <span class="prelude-val">Some</span>(UnifiedNum::from_whole(<span class="number">100</span>)),
            validators: <span class="prelude-val">None</span>,
            title: <span class="prelude-val">None</span>,
            pricing_bounds: <span class="prelude-val">None</span>,
            event_submission: <span class="prelude-val">None</span>,
            targeting_rules: <span class="prelude-val">None</span>,
        };

        <span class="kw">let </span>modify_campaign_json = <span class="macro">json!</span>({
            <span class="string">&quot;ad_units&quot;</span>: null,
            <span class="string">&quot;budget&quot;</span>: <span class="string">&quot;10000000000&quot;</span>,
            <span class="string">&quot;validators&quot;</span>: null,
            <span class="string">&quot;title&quot;</span>: null,
            <span class="string">&quot;pricing_bounds&quot;</span>: null,
            <span class="string">&quot;event_submission&quot;</span>: null,
            <span class="string">&quot;targeting_rules&quot;</span>: null,
        });

        <span class="kw">let </span>modify_campaign_json =
            serde_json::to_string(<span class="kw-2">&amp;</span>modify_campaign_json).expect(<span class="string">&quot;should serialize&quot;</span>);
        <span class="kw">let </span>deserialized: ModifyCampaign =
            serde_json::from_str(<span class="kw-2">&amp;</span>modify_campaign_json).expect(<span class="string">&quot;should deserialize&quot;</span>);

        <span class="macro">assert_eq!</span>(modify_campaign, deserialized);
    }
}</code></pre></div>
<h5 id="post-v5campaignidevents"><a href="#post-v5campaignidevents">POST <code>/v5/campaign/:id/events</code></a></h5>
<p>Add new <a href="../../primitives/sentry/event/enum.Event.html"><code>Event</code></a>s (<code>IMPRESSION</code>s &amp; <code>CLICK</code>s) to the <a href="../../primitives/campaign/struct.Campaign.html"><code>Campaign</code></a>.
Applies <a href="../../primitives/campaign/struct.Campaign.html#structfield.event_submission"><code>Campaign.event_submission</code></a> rules and additional validation using <a href="../access/fn.check_access.html"><code>check_access()</code></a>.</p>
<p>The route is handled by <a href="campaign/insert_events/fn.handle_route.html" title="campaign::insert_events::handle_route()"><code>campaign::insert_events::handle_route()</code></a>.</p>
<p>Request body (json): <a href="../../primitives/sentry/struct.InsertEventsRequest.html"><code>InsertEventsRequest</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.SuccessResponse.html"><code>SuccessResponse</code></a></p>
<h5 id="post-v5campaignidclose-auth-required"><a href="#post-v5campaignidclose-auth-required">POST <code>/v5/campaign/:id/close</code> (auth required)</a></h5>
<p>Close the campaign.</p>
<p>The route is handled by <a href="campaign/fn.close_campaign.html" title="campaign::close_campaign()"><code>campaign::close_campaign()</code></a>.</p>
<p>Request must be sent by the <a href="../../primitives/campaign/struct.Campaign.html#structfield.creator"><code>Campaign.creator</code></a>.</p>
<p><strong>Authentication is required</strong> to validate <a href="../../primitives/campaign/struct.Campaign.html#structfield.creator"><code>Campaign.creator</code></a> == <a href="../struct.Auth.html#structfield.uid"><code>Auth.uid</code></a></p>
<p>Closes the campaign by setting <a href="../../primitives/campaign/struct.Campaign.html#structfield.budget"><code>Campaign.budget</code></a> so that <code>remaining budget = 0</code>.</p>
<p>Response: <a href="../../primitives/sentry/struct.SuccessResponse.html"><code>SuccessResponse</code></a></p>
<h3 id="analytics"><a href="#analytics">Analytics</a></h3><h5 id="get-v5analytics"><a href="#get-v5analytics">GET <code>/v5/analytics</code></a></h5>
<p>Allowed keys: <a href="../../primitives/analytics/query/enum.AllowedKey.html#variant.Country" title="primitives::analytics::query::AllowedKey::Country"><code>AllowedKey::Country</code></a>, <a href="../../primitives/analytics/query/enum.AllowedKey.html#variant.AdSlotType" title="primitives::analytics::query::AllowedKey::AdSlotType"><code>AllowedKey::AdSlotType</code></a></p>
<p>Request query parameters: <a href="../../primitives/analytics/struct.AnalyticsQuery.html"><code>AnalyticsQuery</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.AnalyticsResponse.html"><code>AnalyticsResponse</code></a></p>
<h6 id="examples-13"><a href="#examples-13">Examples</a></h6>
<p>Query:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{
    analytics::{
        query::{AllowedKey, Time},
        AnalyticsQuery, Metric, OperatingSystem, Timeframe,
    },
    sentry::{DateHour, EventType},
    Address, CampaignId, ChainId, IPFS,
};
<span class="kw">use </span>std::str::FromStr;

<span class="kw">fn </span>main() {
    <span class="comment">// Empty query - default values only
    </span>{
        <span class="kw">let </span>empty_query = <span class="string">&quot;&quot;</span>;
        <span class="kw">let </span>query: AnalyticsQuery = serde_qs::from_str(empty_query).unwrap();

        <span class="macro">assert_eq!</span>(<span class="number">100</span>, query.limit);
        <span class="macro">assert_eq!</span>(EventType::Impression, query.event_type);
        <span class="macro">assert!</span>(<span class="macro">matches!</span>(query.metric, Metric::Count));
        <span class="macro">assert!</span>(<span class="macro">matches!</span>(query.time.timeframe, Timeframe::Day));
    }
    <span class="comment">// Query with different metric/chain/eventType
    </span>{
        <span class="kw">let </span>query_str = <span class="string">&quot;limit=200&amp;eventType=CLICK&amp;metric=paid&amp;timeframe=month&quot;</span>;
        <span class="kw">let </span>query: AnalyticsQuery = serde_qs::from_str(query_str).unwrap();

        <span class="macro">assert_eq!</span>(<span class="number">200</span>, query.limit);
        <span class="macro">assert_eq!</span>(EventType::Click, query.event_type);
        <span class="macro">assert!</span>(<span class="macro">matches!</span>(query.metric, Metric::Paid));
        <span class="macro">assert!</span>(<span class="macro">matches!</span>(query.time.timeframe, Timeframe::Month));
    }

    <span class="comment">// Query with allowed keys for guest - country, slotType
    </span>{
        <span class="kw">let </span>query_str = <span class="string">&quot;country=Bulgaria&amp;adSlotType=legacy_300x100&quot;</span>;
        <span class="kw">let </span>query: AnalyticsQuery = serde_qs::from_str(query_str).unwrap();

        <span class="macro">assert_eq!</span>(<span class="prelude-val">Some</span>(<span class="string">&quot;Bulgaria&quot;</span>.to_string()), query.country);
        <span class="macro">assert_eq!</span>(<span class="prelude-val">Some</span>(<span class="string">&quot;legacy_300x100&quot;</span>.to_string()), query.ad_slot_type);
    }

    <span class="comment">// Query with all possible fields (publisher/advertiser/admin)
    </span>{
        <span class="kw">let </span>query_str = <span class="string">&quot;limit=200&amp;eventType=CLICK&amp;metric=paid&amp;segmentBy=country\
        &amp;timeframe=week&amp;start=2022-08-04+09:00:00.000000000+UTC\
        &amp;campaignId=0x936da01f9abd4d9d80c702af85c822a8\
        &amp;adUnit=QmcUVX7fvoLMM93uN2bD3wGTH8MXSxeL8hojYfL2Lhp7mR\
        &amp;adSlot=Qmasg8FrbuSQpjFu3kRnZF9beg8rEBFrqgi1uXDRwCbX5f\
        &amp;adSlotType=legacy_300x100\
        &amp;advertiser=0xDd589B43793934EF6Ad266067A0d1D4896b0dff0\
        &amp;publisher=0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9\
        &amp;hostname=localhost&amp;country=Bulgaria&amp;osName=Windows\
        &amp;chains[0]=1&amp;chains[1]=1337&quot;</span>;
        <span class="kw">let </span>query: AnalyticsQuery = serde_qs::from_str(query_str).unwrap();

        <span class="macro">assert_eq!</span>(query.limit, <span class="number">200</span>);
        <span class="macro">assert_eq!</span>(query.event_type, EventType::Click);
        <span class="macro">assert!</span>(<span class="macro">matches!</span>(query.metric, Metric::Paid));
        <span class="macro">assert_eq!</span>(query.segment_by, <span class="prelude-val">Some</span>(AllowedKey::Country));
        <span class="macro">assert_eq!</span>(
            query.time,
            Time {
                timeframe: Timeframe::Week,
                start: DateHour::from_ymdh(<span class="number">2022</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">9</span>),
                end: <span class="prelude-val">None</span>,
            }
        );
        <span class="macro">assert_eq!</span>(
            query.campaign_id,
            <span class="prelude-val">Some</span>(
                CampaignId::from_str(<span class="string">&quot;0x936da01f9abd4d9d80c702af85c822a8&quot;</span>)
                    .expect(<span class="string">&quot;should be valid&quot;</span>)
            )
        );
        <span class="macro">assert_eq!</span>(
            query.ad_unit,
            <span class="prelude-val">Some</span>(
                IPFS::from_str(<span class="string">&quot;QmcUVX7fvoLMM93uN2bD3wGTH8MXSxeL8hojYfL2Lhp7mR&quot;</span>)
                    .expect(<span class="string">&quot;should be valid&quot;</span>)
            )
        );
        <span class="macro">assert_eq!</span>(
            query.ad_slot,
            <span class="prelude-val">Some</span>(
                IPFS::from_str(<span class="string">&quot;Qmasg8FrbuSQpjFu3kRnZF9beg8rEBFrqgi1uXDRwCbX5f&quot;</span>)
                    .expect(<span class="string">&quot;should be valid&quot;</span>)
            )
        );
        <span class="macro">assert_eq!</span>(query.ad_slot_type, <span class="prelude-val">Some</span>(<span class="string">&quot;legacy_300x100&quot;</span>.to_string()));
        <span class="macro">assert_eq!</span>(
            query.advertiser,
            <span class="prelude-val">Some</span>(
                Address::from_str(<span class="string">&quot;0xDd589B43793934EF6Ad266067A0d1D4896b0dff0&quot;</span>)
                    .expect(<span class="string">&quot;should be valid&quot;</span>)
            )
        );
        <span class="macro">assert_eq!</span>(
            query.publisher,
            <span class="prelude-val">Some</span>(
                Address::from_str(<span class="string">&quot;0xE882ebF439207a70dDcCb39E13CA8506c9F45fD9&quot;</span>)
                    .expect(<span class="string">&quot;should be valid&quot;</span>)
            )
        );
        <span class="macro">assert_eq!</span>(query.hostname, <span class="prelude-val">Some</span>(<span class="string">&quot;localhost&quot;</span>.to_string()));
        <span class="macro">assert_eq!</span>(query.country, <span class="prelude-val">Some</span>(<span class="string">&quot;Bulgaria&quot;</span>.to_string()));
        <span class="macro">assert_eq!</span>(
            query.os_name,
            <span class="prelude-val">Some</span>(OperatingSystem::Whitelisted(<span class="string">&quot;Windows&quot;</span>.to_string()))
        );
        <span class="macro">assert_eq!</span>(query.chains, <span class="macro">vec!</span>(ChainId::new(<span class="number">1</span>), ChainId::new(<span class="number">1337</span>)));
    }
}</code></pre></div>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::sentry::AnalyticsResponse;
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="kw">let </span>json = <span class="macro">json!</span>({
      <span class="string">&quot;analytics&quot;</span>: [{
        <span class="string">&quot;time&quot;</span>: <span class="number">1659592800</span>,
        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;3&quot;</span>,
        <span class="string">&quot;segment&quot;</span>: null
      },
      {
        <span class="string">&quot;time&quot;</span>: <span class="number">1659592800</span>,
        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;10000000000&quot;</span>,
        <span class="string">&quot;segment&quot;</span>: null
      },
      {
        <span class="string">&quot;time&quot;</span>: <span class="number">1659592800</span>,
        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;100000000&quot;</span>,
        <span class="string">&quot;segment&quot;</span>: <span class="string">&quot;country&quot;
      </span>}]
    });

    <span class="macro">assert!</span>(from_value::&lt;AnalyticsResponse&gt;(json).is_ok());
}</code></pre></div>
<h5 id="get-v5analyticsfor-publisher-auth-required"><a href="#get-v5analyticsfor-publisher-auth-required">GET <code>/v5/analytics/for-publisher</code> (auth required)</a></h5>
<p>Returns all analytics where the currently authenticated address <a href="../struct.Auth.html#structfield.uid"><code>Auth.uid</code></a> is a <strong>publisher</strong>.</p>
<p>All <a href="../../primitives/analytics/query/static.ALLOWED_KEYS.html"><code>ALLOWED_KEYS</code></a> are allowed for this route.</p>
<p>The route is handled by <a href="fn.get_analytics.html" title="get_analytics()"><code>get_analytics()</code></a>.</p>
<p>Request query parameters: <a href="../../primitives/analytics/struct.AnalyticsQuery.html"><code>AnalyticsQuery</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.AnalyticsResponse.html"><code>AnalyticsResponse</code></a></p>
<h6 id="examples-14"><a href="#examples-14">Examples</a></h6>
<p>See <a href="#get-v5analytics">GET <code>/v5/analytics</code></a></p>
<h5 id="get-v5analyticsfor-advertiser-auth-required"><a href="#get-v5analyticsfor-advertiser-auth-required">GET <code>/v5/analytics/for-advertiser</code> (auth required)</a></h5>
<p>Returns all analytics where the currently authenticated address <a href="../struct.Auth.html#structfield.uid"><code>Auth.uid</code></a> is an <strong>advertiser</strong>.</p>
<p>All <a href="../../primitives/analytics/query/static.ALLOWED_KEYS.html"><code>ALLOWED_KEYS</code></a> are allowed for this route.</p>
<p>The route is handled by <a href="fn.get_analytics.html" title="get_analytics()"><code>get_analytics()</code></a>.</p>
<p>Request query parameters: <a href="../../primitives/analytics/struct.AnalyticsQuery.html"><code>AnalyticsQuery</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.AnalyticsResponse.html"><code>AnalyticsResponse</code></a></p>
<h6 id="examples-15"><a href="#examples-15">Examples</a></h6>
<p>See <a href="#get-v5analytics">GET <code>/v5/analytics</code></a></p>
<h5 id="get-v5analyticsfor-admin-auth-required"><a href="#get-v5analyticsfor-admin-auth-required">GET <code>/v5/analytics/for-admin</code> (auth required)</a></h5>
<p>Admin access to the analytics with no restrictions on the keys for filtering.</p>
<p>All <a href="../../primitives/analytics/query/static.ALLOWED_KEYS.html"><code>ALLOWED_KEYS</code></a> are allowed for admins.</p>
<p>Admin addresses are configured in the <a href="../../primitives/config/struct.Config.html#structfield.admins"><code>Config.admins</code></a>.</p>
<p>The route is handled by <a href="fn.get_analytics.html" title="get_analytics()"><code>get_analytics()</code></a>.</p>
<p>Request query parameters: <a href="../../primitives/analytics/struct.AnalyticsQuery.html"><code>AnalyticsQuery</code></a></p>
<p>Response: <a href="../../primitives/sentry/struct.AnalyticsResponse.html"><code>AnalyticsResponse</code></a></p>
<h6 id="examples-16"><a href="#examples-16">Examples</a></h6>
<p>See <a href="#get-v5analytics">GET <code>/v5/analytics</code></a></p>
<h3 id="get-cfg"><a href="#get-cfg">GET <code>/cfg</code></a></h3>
<p>Gets the config that the validator is running on.</p>
<p>The route is handled by <a href="fn.get_cfg.html" title="get_cfg()"><code>get_cfg()</code></a></p>
<p>Response: <a href="../../primitives/config/struct.Config.html"><code>Config</code></a></p>
<h6 id="examples-17"><a href="#examples-17">Examples</a></h6>
<p>Response:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>primitives::{config::GANACHE_CONFIG, Config};
<span class="kw">use </span>serde_json::{from_value, json};

<span class="kw">fn </span>main() {
    <span class="kw">let </span>json = <span class="macro">json!</span>({
      <span class="string">&quot;max_channels&quot;</span>: <span class="number">512</span>,
      <span class="string">&quot;channels_find_limit&quot;</span>: <span class="number">200</span>,
      <span class="string">&quot;campaigns_find_limit&quot;</span>: <span class="number">200</span>,
      <span class="string">&quot;spendable_find_limit&quot;</span>: <span class="number">200</span>,
      <span class="string">&quot;wait_time&quot;</span>: <span class="number">500</span>,
      <span class="string">&quot;msgs_find_limit&quot;</span>: <span class="number">10</span>,
      <span class="string">&quot;analytics_find_limit&quot;</span>: <span class="number">5000</span>,
      <span class="string">&quot;analytics_maxtime&quot;</span>: <span class="number">20000</span>,
      <span class="string">&quot;heartbeat_time&quot;</span>: <span class="number">30000</span>,
      <span class="string">&quot;health_threshold_promilles&quot;</span>: <span class="number">950</span>,
      <span class="string">&quot;health_unsignable_promilles&quot;</span>: <span class="number">750</span>,
      <span class="string">&quot;propagation_timeout&quot;</span>: <span class="number">2000</span>,
      <span class="string">&quot;fetch_timeout&quot;</span>: <span class="number">5000</span>,
      <span class="string">&quot;all_campaigns_timeout&quot;</span>: <span class="number">5000</span>,
      <span class="string">&quot;channel_tick_timeout&quot;</span>: <span class="number">8000</span>,
      <span class="string">&quot;ip_rate_limit&quot;</span>: {
        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ip&quot;</span>,
        <span class="string">&quot;timeframe&quot;</span>: <span class="number">1200000
      </span>},
      <span class="string">&quot;creators_whitelist&quot;</span>: [
        <span class="string">&quot;0xaCBaDA2d5830d1875ae3D2de207A1363B316Df2F&quot;</span>,
        <span class="string">&quot;0xDd589B43793934EF6Ad266067A0d1D4896b0dff0&quot;</span>,
        <span class="string">&quot;0x541b401362Ea1D489D322579552B099e801F3632&quot;
      </span>],
      <span class="string">&quot;validators_whitelist&quot;</span>: [
        <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;</span>,
        <span class="string">&quot;0xf3f583AEC5f7C030722Fe992A5688557e1B86ef7&quot;</span>,
        <span class="string">&quot;0x6B83e7D6B72c098d48968441e0d05658dc17Adb9&quot;
      </span>],
      <span class="string">&quot;admins&quot;</span>: [
        <span class="string">&quot;0x80690751969B234697e9059e04ed72195c3507fa&quot;
      </span>],
      <span class="string">&quot;chain&quot;</span>: {
        <span class="string">&quot;Ganache #1337&quot;</span>: {
          <span class="string">&quot;chain_id&quot;</span>: <span class="number">1337</span>,
          <span class="string">&quot;rpc&quot;</span>: <span class="string">&quot;http://localhost:1337/&quot;</span>,
          <span class="string">&quot;outpace&quot;</span>: <span class="string">&quot;0xAbc27d46a458E2e49DaBfEf45ca74dEDBAc3DD06&quot;</span>,
          <span class="string">&quot;token&quot;</span>: {
            <span class="string">&quot;Mocked TOKEN 1337&quot;</span>: {
              <span class="string">&quot;min_campaign_budget&quot;</span>: <span class="string">&quot;1000000000000000000&quot;</span>,
              <span class="string">&quot;min_validator_fee&quot;</span>: <span class="string">&quot;1000000000000&quot;</span>,
              <span class="string">&quot;precision&quot;</span>: <span class="number">18</span>,
              <span class="string">&quot;address&quot;</span>: <span class="string">&quot;0x2BCaf6968aEC8A3b5126FBfAb5Fd419da6E8AD8E&quot;
            </span>}
          }
        },
        <span class="string">&quot;Ganache #1&quot;</span>: {
          <span class="string">&quot;chain_id&quot;</span>: <span class="number">1</span>,
          <span class="string">&quot;rpc&quot;</span>: <span class="string">&quot;http://localhost:8545/&quot;</span>,
          <span class="string">&quot;outpace&quot;</span>: <span class="string">&quot;0x26CBc2eAAe377f6Ac4b73a982CD1125eF4CEC96f&quot;</span>,
          <span class="string">&quot;token&quot;</span>: {
            <span class="string">&quot;Mocked TOKEN 1&quot;</span>: {
              <span class="string">&quot;min_campaign_budget&quot;</span>: <span class="string">&quot;1000000000000000000&quot;</span>,
              <span class="string">&quot;min_validator_fee&quot;</span>: <span class="string">&quot;1000000000000&quot;</span>,
              <span class="string">&quot;precision&quot;</span>: <span class="number">18</span>,
              <span class="string">&quot;address&quot;</span>: <span class="string">&quot;0x12a28f2bfBFfDf5842657235cC058242f40fDEa6&quot;
            </span>}
          }
        }
      },
      <span class="string">&quot;platform&quot;</span>: {
        <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://platform.adex.network/&quot;</span>,
        <span class="string">&quot;keep_alive_interval&quot;</span>: <span class="number">1200000
      </span>},
      <span class="string">&quot;limits&quot;</span>: {
        <span class="string">&quot;units_for_slot&quot;</span>: {
          <span class="string">&quot;max_campaigns_earning_from&quot;</span>: <span class="number">25</span>,
          <span class="string">&quot;global_min_impression_price&quot;</span>: <span class="string">&quot;1000000&quot;
        </span>}
      }
    });
    <span class="macro">assert_eq!</span>(
        from_value::&lt;Config&gt;(json).expect(<span class="string">&quot;Should deserialize&quot;</span>),
        GANACHE_CONFIG.clone()
    );
}</code></pre></div>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="campaign/index.html" title="sentry::routes::campaign mod">campaign</a></div><div class="item-right docblock-short"><p><code>/v5/campaign</code> routes</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="channel/index.html" title="sentry::routes::channel mod">channel</a></div><div class="item-right docblock-short"><p><code>/v5/channel</code> routes</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="routers/index.html" title="sentry::routes::routers mod">routers</a></div><div class="item-right docblock-short"><p>This module contains all the Sentry REST API routers.</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_analytics.html" title="sentry::routes::get_analytics fn">get_analytics</a></div><div class="item-right docblock-short"><p>GET <code>/v5/analytics</code> routes
Request query parameters: <a href="../../primitives/analytics/struct.AnalyticsQuery.html" title="AnalyticsQuery"><code>AnalyticsQuery</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_cfg.html" title="sentry::routes::get_cfg fn">get_cfg</a></div><div class="item-right docblock-short"><p>GET <code>/cfg</code> request</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="sentry" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0-nightly (9243168fa 2022-08-31)" ></div></body></html>